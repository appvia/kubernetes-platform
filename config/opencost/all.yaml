---
opencost:
  # Use default pricing instead of custom rates
  customPricing:
    # Indicates if we should enable custom pricing
    enabled: false

  # Main exporter configuration
  exporter:
    # Unique identifier for this cluster
    defaultClusterId: PATCH_ME

    # Additional configuration
    extraEnv:
      # Use only KSM v1 metrics for compatibility
      EMIT_KSM_V1_METRICS: "false"
      # Emit only KSM v1 metrics
      EMIT_KSM_V1_METRICS_ONLY: "true"
      # Enable CSV export for data processing
      EXPORT_CSV_FILE: "true"
      # Namespace where OpenCost runs
      KUBECOST_NAMESPACE: "opencost"

  # OpenCost UI configuration
  ui:
    # Indicates if we should enable the OpenCost UI
    enabled: true
    # The port for the OpenCost UI
    uiPort: 9091
    # The service for the OpenCost UI
    service:
      # The port for the OpenCost UI
      port: 9091
      # The target port for the OpenCost UI
      targetPort: 9091
    # The container port for the OpenCost UI
    containerPort: 9091
    # Additional environment variables for the OpenCost UI

  # Prometheus configuration
  prometheus:
    # Indicates if we should enable the internal Prometheus
    internal:
      # Indicates if we should enable the internal Prometheus
      enabled: false
      # The service name for the internal Prometheus
      serviceName: prometheus
      # Namespace of in-cluster Prometheus
      namespaceName: prometheus
      # Service port of in-cluster Prometheus
      port: 9090
    external:
      # Indicates if we should enable the external Prometheus
      enabled: true
      # The URL for the external Prometheus
      url: "http://prometheus-prometheus.prometheus.svc.cluster.local:9090"

  # ServiceMonitor for Prometheus operator
  metrics:
    # Indicates if we should enable the ServiceMonitor for Prometheus operator
    serviceMonitor:
      # Indicates if we should enable the ServiceMonitor for Prometheus operator
      enabled: false
      # The namespace for the ServiceMonitor for Prometheus operator
      namespace: monitoring

  # Service Account with IAM permissions
  serviceAccount:
    # Indicates if we should create the ServiceAccount for OpenCost
    create: true
    # The name for the ServiceAccount for OpenCost
    name: "opencost"

  # Volume mounts for storage and IAM tokens
  extraVolumeMounts:
    - name: cost-data
      mountPath: /var/opencost
    - name: aws-iam-token
      mountPath: /var/run/secrets/eks.amazonaws.com/serviceaccount
      readOnly: true

  extraVolumes:
    # The name for the extra volume for cost data
    - name: cost-data
      # The empty dir for the extra volume for cost data
      emptyDir: {}

# PodDisruptionBudget for high availability
pdb:
  enabled: true
  # -- Minimum number of pods that must be available after the eviction
  minAvailable: 1
  # -- Maximum number of pods that can be unavailable after the eviction
  maxUnavailable: 0

## Network Policies
networkPolicies:
  # Indicates if we should enable the NetworkPolicies for OpenCost
  enabled: true
